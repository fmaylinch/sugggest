<link rel="import" href="components/polymer/polymer.html">
<link rel="import" href="components/core-ajax/core-ajax.html">

<polymer-element name="friend-service" attributes="user friends done">
  <template>

    <style>
    :host {
      display: none;
    }
    </style>

    <core-ajax id="ajax"
      url="/api/users/friends"
      on-core-response="{{friendsLoaded}}"
      handleAs="json">
    </core-ajax>

  </template>
  <script>
  Polymer('friend-service', {

      created: function () {
          this.friends = [];
      },

      userChanged: function()
      {
          if (this.user.logged) {
              var headers = '{"Authorization": "Basic ' + btoa(this.user.email + ':' + this.user.password) + '"}';
              this.$.ajax.headers = headers;
              this.$.ajax.go();
          }
      },

      friendsLoaded: function () {

          console.log("Friends loaded");
          // Make a copy of the loaded data
          this.friends = this.$.ajax.response.slice(0);
          this.done = true;
      },

      refresh: function () {
          this.$.ajax.go();
      }
  });
  </script>
</polymer-element>
