<link rel="import" href="components/polymer/polymer.html">
<link rel="import" href="components/core-ajax/core-ajax.html">

<polymer-element name="suggestion-service" attributes="user suggestions done">
  <template>

    <style>
    :host {
      display: none;
    }
    </style>

    <core-ajax id="ajax"
      url="/api/suggestions"
      on-core-response="{{suggestionsLoaded}}"
      handleAs="json">
    </core-ajax>

  </template>
  <script>
    Polymer('suggestion-service', {

        created: function () {
            this.suggestions = [];
        },

        userChanged: function() {

            if (this.user.logged) {

                var headers = { Authorization: "Basic " + btoa(this.user.email + ":" + this.user.password) };

                console.log("user", this.user);
                console.log("header for suggestions", JSON.stringify(headers));

                this.$.ajax.headers = JSON.stringify(headers);

                this.$.ajax.go();
            }
        },

        suggestionsLoaded: function () {

            console.log("Suggestions loaded");
            // Make a copy of the loaded data
            this.suggestions = this.$.ajax.response.slice(0);
            this.done = true;
        },

        refresh: function () {
            this.$.ajax.go();
        }
    });
  </script>
</polymer-element>
